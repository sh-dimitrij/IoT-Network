{% extends "layout.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2>üîç –ê–Ω–∞–ª–∏–∑ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ IoT —Å–µ—Ç–∏</h2>
        <p class="text-muted">–ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Å–≤—è–∑–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–∞–≥—Ä–∞—Ñ–æ–≤</p>
    </div>
    <div class="col-auto">
        <a href="{{ url_for('network_details', network_id=network_info.network.id) }}" 
           class="btn btn-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–µ—Ç–∏
        </a>
    </div>
</div>

{% if not analysis_result %}
<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4>–ê–Ω–∞–ª–∏–∑ —Å–µ—Ç–∏: {{ network_info.network.network_name }}</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <h6>–ü–µ—Ä–µ–¥ –∞–Ω–∞–ª–∏–∑–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å:</h6>
                    <ul>
                        <li>–î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ —Å–µ—Ç—å</li>
                        <li>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–º–µ—é—Ç —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Å–æ–±–æ–π</li>
                        <li>–°–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∏–Ω–∏–º—É–º 2 —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</li>
                    </ul>
                </div>
                
                <h5>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ç–∏:</h5>
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3>{{ network_info.stats.total_devices }}</h3>
                                <p class="text-muted">–£—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3>{{ network_info.stats.total_connections }}</h3>
                                <p class="text-muted">–°–≤—è–∑–µ–π</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3>{{ network_info.stats.total_data_sources }}</h3>
                                <p class="text-muted">–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h3>{{ network_info.stats.total_analyses }}</h3>
                                <p class="text-muted">–ê–Ω–∞–ª–∏–∑–æ–≤</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form method="POST">
                    <button type="submit" class="btn btn-success btn-lg">
                        üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ —Ç–æ–ø–æ–ª–æ–≥–∏–∏
                    </button>
                    <p class="text-muted mt-2 small">
                        –ë—É–¥—É—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã: —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ç–∏, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–∑–ª—ã, –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ —Å–≤—è–∑–∏
                    </p>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5>–ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è?</h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <h6>üìä –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å —Å–µ—Ç–∏</h6>
                    <p class="small">–°—Ä–µ–¥–Ω—è—è —Å—Ç–µ–ø–µ–Ω—å —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö —É–∑–ª–æ–≤ —Å–µ—Ç–∏ (0-1)</p>
                </div>
                
                <div class="mb-3">
                    <h6>üîó –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Å–≤—è–∑–∏</h6>
                    <p class="small">–î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∏–ª–∏ —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏</p>
                </div>
                
                <div class="mb-3">
                    <h6>üìç –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–∑–ª—ã</h6>
                    <p class="small">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–µ–∑ —Å–≤—è–∑–µ–π —Å –¥—Ä—É–≥–∏–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —Å–µ—Ç–∏</p>
                </div>
                
                <div class="mb-3">
                    <h6>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h6>
                    <p class="small">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å–µ—Ç–∏</p>
                </div>
            </div>
        </div>
    </div>
</div>

{% else %}
<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ -->
<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h4>
            </div>
            <div class="card-body">
                <div class="row text-center mb-4">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h3>{{ "%.4f"|format(analysis_result.centrality_score) }}</h3>
                                <p class="text-muted">–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="{{ 'text-danger' if analysis_result.isolated_nodes_count > 0 else 'text-success' }}">
                                    {{ analysis_result.isolated_nodes_count }}
                                </h3>
                                <p class="text-muted">–ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É–∑–ª–æ–≤</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="{{ 'text-warning' if analysis_result.redundant_links_count > 0 else 'text-success' }}">
                                    {{ analysis_result.redundant_links_count }}
                                </h3>
                                <p class="text-muted">–ò–∑–±—ã—Ç–æ—á–Ω—ã—Ö —Å–≤—è–∑–µ–π</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-body">
                                <h3 class="{{ 'text-danger' if analysis_result.total_issues > 0 else 'text-success' }}">
                                    {{ analysis_result.total_issues }}
                                </h3>
                                <p class="text-muted">–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <p><strong>–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:</strong> {{ analysis_result.analysis_date }}</p>
                <p><strong>–í—Å–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ –∞–Ω–∞–ª–∏–∑–µ:</strong> {{ analysis_result.total_devices }}</p>
                
                <hr>
                
                {% if analysis_result.isolated_nodes_count > 0 %}
                <div class="mb-4">
                    <h5>üìç –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–∑–ª—ã:</h5>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</th>
                                    <th>–ò–º—è</th>
                                    <th>–¢–∏–ø</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for node in analysis_result.isolated_nodes %}
                                <tr>
                                    <td>{{ node.id }}</td>
                                    <td>{{ node.name }}</td>
                                    <td><span class="badge bg-info">{{ node.type }}</span></td>
                                    <td><span class="badge bg-{{ 'success' if node.status == 'active' else 'secondary' }}">{{ node.status }}</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
                
                {% if analysis_result.redundant_links_count > 0 %}
                <div class="mb-4">
                    <h5>üîó –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Å–≤—è–∑–∏:</h5>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 1</th>
                                    <th>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 2</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for link in analysis_result.redundant_links %}
                                <tr>
                                    <td>{{ link.device1_name }} (ID: {{ link.device1_id }})</td>
                                    <td>{{ link.device2_name }} (ID: {{ link.device2_id }})</td>
                                    <td><span class="badge bg-warning">–î—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è —Å–≤—è–∑—å</span></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}
                
                <div class="alert alert-info">
                    <h5>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:</h5>
                    <ul>
                        {% for recommendation in analysis_result.recommendations %}
                        <li>{{ recommendation }}</li>
                        {% endfor %}
                    </ul>
                </div>
                
                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <a href="{{ url_for('analyze_network', network_id=network_info.network.id) }}" 
                       class="btn btn-primary">
                        üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∞–Ω–∞–ª–∏–∑
                    </a>
                    <a href="{{ url_for('network_details', network_id=network_info.network.id) }}" 
                       class="btn btn-success">
                        ‚úÖ –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–µ—Ç–∏
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}