<!-- templates/load_data.html -->
{% extends "layout.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö IoT</h2>
        <p class="text-muted">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –∏ –∏—Ö —Å–≤—è–∑—è—Ö –¥–ª—è —Å–µ—Ç–∏: {{ network_info.network.name }}</p>
    </div>
    <div class="col-auto">
        <a href="{{ url_for('network_details', network_id=network_info.network.id) }}" 
           class="btn btn-secondary">
            ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–µ—Ç–∏
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <!-- –í—ã–±–æ—Ä –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö -->
        <div class="card mb-4">
            <div class="card-header">
                <h4>–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h4>
            </div>
            <div class="card-body">
                <form method="POST" onsubmit="return confirm('–í–Ω–∏–º–∞–Ω–∏–µ! –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –Ω–æ–≤–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ —ç—Ç–æ–π —Å–µ—Ç–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?');">
                    <input type="hidden" name="action" value="load_sample">
                    
                    <div class="row">
                        {% for dataset_key, dataset in datasets.items() %}
                        <div class="col-md-6 mb-3">
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">{{ dataset.name }}</h5>
                                    <p class="card-text small">{{ dataset.description }}</p>
                                    <ul class="small text-muted">
                                        <li>–£—Å—Ç—Ä–æ–π—Å—Ç–≤: {{ dataset.devices|length }}</li>
                                        <li>–°–≤—è–∑–µ–π: {{ dataset.connections|length }}</li>
                                        <li>–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤: {{ dataset.data_sources|length }}</li>
                                    </ul>
                                    <button type="submit" name="dataset" value="{{ dataset_key }}" 
                                            class="btn btn-primary btn-sm">
                                        –ó–∞–≥—Ä—É–∑–∏—Ç—å —ç—Ç–æ—Ç –Ω–∞–±–æ—Ä
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </form>
            </div>
        </div>
        
        <!-- –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
        <div class="card mb-4">
            <div class="card-header">
                <h4>–î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤—Ä—É—á–Ω—É—é</h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="action" value="add_device">
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="device_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ *</label>
                                <input type="text" class="form-control" id="device_name" name="device_name" required>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="device_type" class="form-label">–¢–∏–ø *</label>
                                <select class="form-select" id="device_type" name="device_type" required>
                                    <option value="sensor">–î–∞—Ç—á–∏–∫ (sensor)</option>
                                    <option value="actuator">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ (actuator)</option>
                                    <option value="gateway">–®–ª—é–∑ (gateway)</option>
                                    <option value="controller">–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (controller)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="mb-3">
                                <label for="device_status" class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                <select class="form-select" id="device_status" name="device_status">
                                    <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                                    <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                                    <option value="maintenance">–ù–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info">
                        <small>
                            <strong>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:</strong> –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É 
                            —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç—å—é.
                        </small>
                    </div>
                    
                    <button type="submit" class="btn btn-success">
                        –î–æ–±–∞–≤–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
                    </button>
                </form>
            </div>
        </div>
        
        <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö -->
        <div class="card">
            <div class="card-header">
                <h4>–î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö</h4>
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="action" value="add_source">
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label for="source_name" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ *</label>
                                <input type="text" class="form-control" id="source_name" name="source_name" 
                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Weather API, MQTT Broker, Database" required>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="source_type" class="form-label">–¢–∏–ø *</label>
                                <select class="form-select" id="source_type" name="source_type" required>
                                    <option value="api">API</option>
                                    <option value="database">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</option>
                                    <option value="stream">–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö</option>
                                    <option value="file">–§–∞–π–ª</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-light">
                        <small>
                            <strong>–¢–∏–ø—ã –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:</strong><br>
                            ‚Ä¢ <strong>API</strong> - –≤–Ω–µ—à–Ω–∏–µ REST API –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã<br>
                            ‚Ä¢ <strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</strong> - SQL/NoSQL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö<br>
                            ‚Ä¢ <strong>–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö</strong> - MQTT, Kafka, WebSocket<br>
                            ‚Ä¢ <strong>–§–∞–π–ª</strong> - CSV, JSON, XML —Ñ–∞–π–ª—ã
                        </small>
                    </div>
                    
                    <button type="submit" class="btn btn-info">
                        –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–∏ -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ç–∏</h5>
            </div>
            <div class="card-body">
                <p><strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> {{ network_info.network.name }}</p>
                <p><strong>–£—Å—Ç—Ä–æ–π—Å—Ç–≤:</strong> {{ network_info.stats.total_devices }}</p>
                <p><strong>–ò—Å—Ç–æ—á–Ω–∏–∫–æ–≤:</strong> {{ network_info.stats.total_data_sources }}</p>
                <p><strong>–°–≤—è–∑–µ–π:</strong> {{ network_info.stats.total_connections }}</p>
                <hr>
                <h6>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h6>
                <ul class="small">
                    <li>–ù–∞—á–Ω–∏—Ç–µ —Å –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö</li>
                    <li>–î–æ–±–∞–≤–ª—è–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</li>
                    <li>–£–∫–∞–∑—ã–≤–∞–π—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</li>
                    <li>–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ–¥–∏—Ç–µ –∞–Ω–∞–ª–∏–∑ —Ç–æ–ø–æ–ª–æ–≥–∏–∏</li>
                </ul>
            </div>
        </div>
        
        <!-- –¢–µ–∫—É—â–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ -->
        <div class="card">
            <div class="card-header">
                <h5>–¢–µ–∫—É—â–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ({{ network_info.devices|length }})</h5>
            </div>
            <div class="card-body" style="max-height: 300px; overflow-y: auto;">
                {% if network_info.devices %}
                    <div class="list-group">
                        {% for device in network_info.devices %}
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <strong>{{ device.name }}</strong>
                                    <br>
                                    <small class="text-muted">
                                        <span class="badge bg-info">{{ device.type }}</span>
                                        <span class="badge bg-{{ 'success' if device.status == 'active' else 'secondary' }}">
                                            {{ device.status }}
                                        </span>
                                    </small>
                                </div>
                                <div>
                                    <form method="POST" action="{{ url_for('manage_device', device_id=device.id) }}" 
                                          class="d-inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ?');">
                                        <input type="hidden" name="action" value="delete">
                                        <input type="hidden" name="network_id" value="{{ network_info.network.id }}">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">
                                            üóëÔ∏è
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">–ù–µ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
                {% endif %}
            </div>
        </div>
        
        <!-- –¢–µ–∫—É—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ -->
        {% if network_info.data_sources %}
        <div class="card mt-3">
            <div class="card-header">
                <h5>–¢–µ–∫—É—â–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ ({{ network_info.data_sources|length }})</h5>
            </div>
            <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                <div class="list-group">
                    {% for source in network_info.data_sources %}
                    <div class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <small><strong>{{ source.name }}</strong></small>
                                <br>
                                <small class="text-muted">
                                    <span class="badge bg-info">{{ source.type }}</span>
                                    {{ source.last_update[:16] }}
                                </small>
                            </div>
                            <div>
                                <form method="POST" action="{{ url_for('manage_source', source_id=source.id) }}" 
                                      class="d-inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫?');">
                                    <input type="hidden" name="action" value="delete">
                                    <input type="hidden" name="network_id" value="{{ network_info.network.id }}">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">
                                        üóëÔ∏è
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}